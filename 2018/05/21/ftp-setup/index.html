<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">

<script>
    (function () {
        if ('') {
            if (prompt('请输入文章密码') !== '') {
                alert('密码错误！');
                if (history.length === 1) {
                    location.replace("https://peithon.github.io/");
                } else {
                    history.back();
                }
            }
        }
    })();
</script>








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="ftp的搭建,建立虚拟用户,ftp常用命令," />










<meta name="description" content="搭建ftp服务器时一般使用本地用户来访问ftp，虽然可以限制用户权限，但安全性还是没有使用虚拟用户登录高，下面通过建立虚拟用户来搭建FTP服务器。">
<meta name="keywords" content="ftp的搭建,建立虚拟用户,ftp常用命令">
<meta property="og:type" content="article">
<meta property="og:title" content="ftp服务器的简单搭建流程">
<meta property="og:url" content="https://peithon.github.io/2018/05/21/ftp-setup/index.html">
<meta property="og:site_name" content="Peithon&#39;s Blog">
<meta property="og:description" content="搭建ftp服务器时一般使用本地用户来访问ftp，虽然可以限制用户权限，但安全性还是没有使用虚拟用户登录高，下面通过建立虚拟用户来搭建FTP服务器。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://p8urkh0xe.bkt.clouddn.com/ftp-5001.png">
<meta property="og:updated_time" content="2018-07-21T11:23:15.966Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ftp服务器的简单搭建流程">
<meta name="twitter:description" content="搭建ftp服务器时一般使用本地用户来访问ftp，虽然可以限制用户权限，但安全性还是没有使用虚拟用户登录高，下面通过建立虚拟用户来搭建FTP服务器。">
<meta name="twitter:image" content="http://p8urkh0xe.bkt.clouddn.com/ftp-5001.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'ALRPI3MQ3Q',
      apiKey: '4b6097ecc165e38bab8cc2d0e5d4f370',
      indexName: 'key_wordSelect',
      hits: {"per_page":10},
      labels: {"input_placeholder":"输入关键字","hits_empty":"没有找到与${query}相关的内容","hits_stats":"${hits}条记录，共耗时 ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://peithon.github.io/2018/05/21/ftp-setup/"/>





  <title>ftp服务器的简单搭建流程 | Peithon's Blog</title>
  








  <script type="text/javascript" src="/js/src/love.js"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Peithon's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://peithon.github.io/2018/05/21/ftp-setup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Peithon">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Peithon's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ftp服务器的简单搭建流程</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-21T18:53:08+08:00">
                2018-05-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/FTP服务器/" itemprop="url" rel="index">
                    <span itemprop="name">FTP服务器</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/05/21/ftp-setup/" class="leancloud_visitors" data-flag-title="ftp服务器的简单搭建流程">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  9 min
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>搭建ftp服务器时一般使用本地用户来访问ftp，虽然可以限制用户权限，但安全性还是没有使用虚拟用户登录高，下面通过建立虚拟用户来搭建FTP服务器。</p>
<a id="more"></a>
<h2 id="FTP用户登陆一般分为三种类型"><a href="#FTP用户登陆一般分为三种类型" class="headerlink" title="FTP用户登陆一般分为三种类型"></a>FTP用户登陆一般分为三种类型</h2><h3 id="匿名用户"><a href="#匿名用户" class="headerlink" title="匿名用户"></a>匿名用户</h3><p>不需要登陆即可直接使用FTP传输文件，匿名访问模式的FTP根目录为/var/ftp</p>
<h3 id="本地用户"><a href="#本地用户" class="headerlink" title="本地用户"></a>本地用户</h3><p>本地用户即服务器端（除root外）的普通用户</p>
<h3 id="虚拟用户"><a href="#虚拟用户" class="headerlink" title="虚拟用户"></a>虚拟用户</h3><p>在vsftpd服务器中，使用虚拟用户的主要好处在于，可以将登录的账号与系统登录的账号区分开来，用户名，密码都不相同，从而进一步增强了FTP服务器的安全性。另外虚拟用户都具有独立的配置选项。可以灵活的控制对ftp服务器的访问。可以控制用户读的权限，写权限，下载，上传的权限</p>
<h1 id="0x00-FTP的安装"><a href="#0x00-FTP的安装" class="headerlink" title="0x00 FTP的安装"></a>0x00 FTP的安装</h1><p>1).查询vsftpd是否安装</p>
<pre><code># rpm -qc vsftpd
</code></pre><p>2).安装vsftpd</p>
<pre><code># yum -y install vsftpd
</code></pre><p>3).安装vsftpd虚拟用户配置依赖包</p>
<pre><code># yum install -y psmisc net-tools systemd-devel libdb-devel perl-DBI
</code></pre><p>4).启动vsftpd</p>
<pre><code># systemctl start vsftpd
</code></pre><p>5).设置开机启动</p>
<pre><code># systemctl enable vsftpd
</code></pre><h1 id="0x01-新建系统用户"><a href="#0x01-新建系统用户" class="headerlink" title="0x01 新建系统用户"></a>0x01 新建系统用户</h1><p>1).添加用户vsuser</p>
<pre><code>设置登录shell为/bin/false,使该用户不能登录
# useradd vsuser -d /home/vsftp -s /bin/false
</code></pre><p>2).修改目录的所有权</p>
<pre><code>递归将vsftp目录下的所有者修改为vsuser
# chown vsuser:vsuser -R /home/vsftp
</code></pre><h1 id="0x02-设置vsftpd服务器的配置文件"><a href="#0x02-设置vsftpd服务器的配置文件" class="headerlink" title="0x02 设置vsftpd服务器的配置文件"></a>0x02 设置vsftpd服务器的配置文件</h1><p>1).备份文件</p>
<pre><code># cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.bak
</code></pre><p>2).编辑配置内容</p>
<pre><code># vi cp /etc/vsftpd/vsftpd.conf

    #禁止匿名访问
　　anonymous_enable=NO
　　anon_upload_enable=NO
　　anon_mkdir_write_enable=YES

    chown_uploads=NO     //不允许用户修改上传文件的属主

    async_abor_enable=YES               //允许执行特殊的ftp命令
    ascii_upload_enable=YES              //允许使用ascii码方式上传文件
    ascii_download_enable=YES            //允许使用ascii码方式下载文件
    ftpd_banner=Welcome to FTP service.
</code></pre><p>输入以下命令添加一些属性到配置文件：</p>
<pre><code># echo -e &quot;use_localtime=YES\nlisten_port=21\nchroot_local_user=YES\nidle_session_timeout=300

\ndata_connection_timeout=1\nguest_enable=YES\nguest_username=vsuser #此处要和刚刚创建的用户名一致

\nuser_config_dir=/etc/vsftpd/vconf\nvirtual_use_local_privs=YES

\npasv_min_port=10060\npasv_max_port=10090

\naccept_timeout=5\nconnect_timeout=1&quot; &gt;&gt; /etc/vsftpd/vsftpd.conf
</code></pre><p>下面是一些属性的解释：</p>
<pre><code>chroot_list_enable=NO 　　　　　　　　　　// 不允许用户离开自己的主目录
　　chroot_list_file=/etc/vsftpd.chroot_list　　  // 虚拟用户列表，每行一个用户名
　　local_enable=YES 　　　　　　　　　　 　　 // 允许本地用户访问
　　write_enable=YES 　　　　　　　　　　　　 // 允许本地用户写入
　　local_umask=022 　　　　　　　　　　　　 // 上传后的文件的默认掩码
　　chroot_local_user=YES 　　　　　　　　　　 // 禁止本地用户离开自己的主目录
　　pam_service_name=vsftpd.vu 　　　　　　 // 权限验证需要的加密文件
　　guest_enable=YES 　　　　　　　　　　　　 // 开启虚拟用户功能
　　guest_username=vsuser　　　　　　　　　　　// 虚拟用户的宿主目录，即虚拟用户映射为本地vsuser用户
　　virtual_use_local_privs=YES 　　　　　　   // 用户登录后操作目录和本地用户权限一样
　　user_config_dir=/etc/vsftpd/vconf 　　　　// 虚拟用户主目录设置文件
　　allow_writeable_chroot=YES 　　　　　　 // 允许写入用户主目录，这条特别重要
</code></pre><h1 id="0x03-虚拟用户个人vsftp服务器的配置文件"><a href="#0x03-虚拟用户个人vsftp服务器的配置文件" class="headerlink" title="0x03 虚拟用户个人vsftp服务器的配置文件"></a>0x03 虚拟用户个人vsftp服务器的配置文件</h1><p>1).创建文件夹</p>
<pre><code># mkdir /etc/vsftpd/vconf
</code></pre><p>2).创建虚拟用户配置文件</p>
<pre><code># touch /etc/vsftpd/vconf/vsuser1
# mkdir -p /home/vsftp/vsuser1/http/mydic
</code></pre><h1 id="0x04-虚拟用户名单文件"><a href="#0x04-虚拟用户名单文件" class="headerlink" title="0x04 虚拟用户名单文件"></a>0x04 虚拟用户名单文件</h1><pre><code># touch /etc/vsftpd/virtusers
</code></pre><p>编辑虚拟用户名单内容(奇数行是账号，偶数行是密码)：</p>
<pre><code>#vi /etc/vsftpd/virtusers
vsuser1
123456
#保存退出
</code></pre><h1 id="0x05-设置权限"><a href="#0x05-设置权限" class="headerlink" title="0x05 设置权限"></a>0x05 设置权限</h1><p>1).主目录不能有写的权限所以ftp为755，主目录下面的子目录设置为777权限</p>
<pre><code># chmod -R 755 /home/vsftp/vsuser1/http
# chmod -R 777 /home/vsftp/vsuser1/http/mydic
</code></pre><p>2).编辑虚拟用户配置文件</p>
<pre><code>#文件名要与虚拟用户名相同
# vi /etc/vsftpd/vconf/vsuser1

local_root=/home/vsftp/vsuser1/http/　　#设置FTP账号根目录     
write_enable=YES     
anon_world_readable_only=NO     
anon_upload_enable=YES     
anon_mkdir_write_enable=YES     
anon_other_write_enable=YES         #允许删除和重名名
#保存退出
</code></pre><h1 id="0x06-生成虚拟用户数据文件"><a href="#0x06-生成虚拟用户数据文件" class="headerlink" title="0x06 生成虚拟用户数据文件"></a>0x06 生成虚拟用户数据文件</h1><pre><code># db_load -T -t hash -f /etc/vsftpd/virtusers /etc/vsftpd/virtusers.db
</code></pre><h1 id="0x07-设定PAM验证文件，并指定对虚拟用户数据库文件进行读取"><a href="#0x07-设定PAM验证文件，并指定对虚拟用户数据库文件进行读取" class="headerlink" title="0x07 设定PAM验证文件，并指定对虚拟用户数据库文件进行读取"></a>0x07 设定PAM验证文件，并指定对虚拟用户数据库文件进行读取</h1><pre><code># chmod 600 /etc/vsftpd/virtusers.db
</code></pre><p>在/etc/pam.d/vsftpd文件的头部添加一下信息(只能在头部添加)</p>
<p>1).备份文件</p>
<pre><code># cp /etc/pam.d/vsftpd /etc/pam.d/vsftpd.bak
</code></pre><p>2).添加信息</p>
<pre><code># vi /etc/pam.d/vsftpd
</code></pre><p>将所有配置都注释掉，加入下面内容</p>
<pre><code>auth sufficient /lib64/security/pam_userdb.so db=/etc/vsftpd/virtusers
account sufficient /lib64/security/pam_userdb.so db=/etc/vsftpd/virtusers
</code></pre><h1 id="0x08-防火墙配置文件"><a href="#0x08-防火墙配置文件" class="headerlink" title="0x08 防火墙配置文件"></a>0x08 防火墙配置文件</h1><p>1).关闭firewall</p>
<p>停止firewall</p>
<pre><code># systemctl stop firewalld.service
</code></pre><p>禁止firewall开机启动</p>
<pre><code># systemctl disable firewalld.service
</code></pre><p>安装iptables</p>
<pre><code># yum -y install iptables
# yum -y update iptables
</code></pre><p>2).添加防火墙规则</p>
<pre><code># vi /etc/sysconfig/iptables

-A INPUT -m state --state NEW -m tcp -p tcp --dport 21 -j ACCEPT 
-A INPUT -m state --state NEW -m tcp -p tcp --dport 10060:10090 -j ACCEPT
#保存退出
</code></pre><p>3).重启防火墙</p>
<pre><code># systemctl restart iptables.service
</code></pre><p>4).设置开机启动</p>
<pre><code># systemctl enable iptables.service
</code></pre><h1 id="0x09-关闭SELINUX"><a href="#0x09-关闭SELINUX" class="headerlink" title="0x09 关闭SELINUX"></a>0x09 关闭SELINUX</h1><pre><code># vi /etc/selinux/config 
#SELINUX=enforcing #注释掉
#SELINUXTYPE=targeted #注释掉
SELINUX=disabled #增加
#保存退出
</code></pre><p>执行命令使配置生效</p>
<pre><code># setenforce 0
</code></pre><h1 id="0X10-重启vsftpd服务器"><a href="#0X10-重启vsftpd服务器" class="headerlink" title="0X10 重启vsftpd服务器"></a>0X10 重启vsftpd服务器</h1><pre><code># systemctl restart vsftpd.service
</code></pre><h1 id="0x11-安装ftp客户端"><a href="#0x11-安装ftp客户端" class="headerlink" title="0x11 安装ftp客户端"></a>0x11 安装ftp客户端</h1><pre><code># rpm -Uvh http://mirror.centos.org/centos/6/os/x86_64/Packages/ftp-0.17-54.el6.x86_64.rpm
</code></pre><h1 id="0x12-FTP数字代码的意义"><a href="#0x12-FTP数字代码的意义" class="headerlink" title="0x12 FTP数字代码的意义"></a>0x12 FTP数字代码的意义</h1><pre><code>110 重新启动标记应答
120 服务在多久时间内 ready 
125 数据链路端口开启，准备传送 
150 文件状态正常，开启数据连接端口
200 命令执行成功 
202 命令执行失败
211 系统状态或是系统求助响应 
212 目录的状态 
213 文件的状态
214 求助的讯息 
215 名称系统类型 
220 新的联机服务 ready 
221 服务的控制连接端口关闭，可以注销 
225 数据连结开启，但无传输动作
226 关闭数据连接端口，请求的文件操作成功 
227 进入 passive mode 
230 使用者登入
250 请求的文件操作完成
257 显示目前的路径名称
331 用户名称正确，需要密码
332 登入时需要账号信息
350 请求的操作需要进一部的命令
421 无法提供服务，关闭控制连结 
425 无法开启数据链路
426 关闭联机，终止传输
450 请求的操作未执行 
451 命令终止 : 有本地的错误 
452 未执行命令 : 磁盘空间不足 
500 格式错误，无法识别命令 
501 参数语法错误
502 命令执行失败
503 命令顺序错误 
504 命令所接的参数不正确 
530 未登入
532 储存文件需要账户登入
550 未执行请求的操作
551 请求的命令终止，类型未知
552 请求的文件终止，储存位溢出
553 未执行请求的的命令，名称不正确
</code></pre><h1 id="0x13-测试ftp"><a href="#0x13-测试ftp" class="headerlink" title="0x13 测试ftp"></a>0x13 测试ftp</h1><h2 id="本地测试报500错误"><a href="#本地测试报500错误" class="headerlink" title="本地测试报500错误"></a>本地测试报500错误</h2><pre><code>500 OOPS: vsftpd:  refusing to run with writable root inside chroot()
</code></pre><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><pre><code># vi /etc/vsftpd/vsftpd.conf
</code></pre><p>添加</p>
<pre><code>allow_writeable_chroot=YES
</code></pre><p>前面说了这一条特别重要，但是没有添加，所以才出了这样的错</p>
<p>重启vsftpd服务</p>
<pre><code>systemctl restart vsftpd.service
</code></pre><p>再次登录,成功</p>
<p><img src="http://p8urkh0xe.bkt.clouddn.com/ftp-5001.png" alt=""></p>
<p>出现数字代码229,这是被动模式的问题，登录后输入passive回车，然后再ls</p>
<h2 id="其他主机无法连接ftp"><a href="#其他主机无法连接ftp" class="headerlink" title="其他主机无法连接ftp"></a>其他主机无法连接ftp</h2><h3 id="解决方法-1"><a href="#解决方法-1" class="headerlink" title="解决方法"></a>解决方法</h3><pre><code>关闭防火墙
# systemctl stop iptables.service
</code></pre><h1 id="0x14-ftp常用命令"><a href="#0x14-ftp常用命令" class="headerlink" title="0x14 ftp常用命令"></a>0x14 ftp常用命令</h1><pre><code>ls                                    显示服务器上的目录
ls [remote-dir][local-file]          显示远程目录remote-dir，并存入本地文件local-file 
get remote-file [local-file]           从服务器下载指定文件到客户端
mget remote-files                   下载多个远程文件(mget命令允许用通配符下载多个文件)
put local-file [remote-file]          从客户端上传指定文件到服务器 
mput local-file                      将多个文件上传至远程主机(mput命令允许用通配符上传多个文件) 
open                                   连接FTP服务器 
mput local-file                        将多个文件上传至远程主机(mput命令允许用通配符上传多个文件) 
mdelete [remote-file]                  删除远程主机文件
close                                中断与远程服务器的ftp会话（与open对应）
mkdir dir-name                         在远程主机中创建目录 
open host[port]                        建立指定的ftp服务器连接，可指定连接端口
cd directory                          改变服务器的工作目录 
rename [from][to]                      更改远程主机的文件名
bye|quit|exit                        退出FTP命令状态
reget remote-file [local-file]         类似于get,但若local-file存在，则从上次传输中断处续传   
delete remote-file                     删除远程主机文件
user user-name [password][account]  向远程主机表明自己的身份，需要密码时，必须输入密码 
</code></pre><h1 id="0x15-添加只有下载权限的新虚拟用户"><a href="#0x15-添加只有下载权限的新虚拟用户" class="headerlink" title="0x15 添加只有下载权限的新虚拟用户"></a>0x15 添加只有下载权限的新虚拟用户</h1><h3 id="1-创建虚拟用户的配置文件"><a href="#1-创建虚拟用户的配置文件" class="headerlink" title="1.创建虚拟用户的配置文件"></a>1.创建虚拟用户的配置文件</h3><pre><code>#文件名要与虚拟用户名相同
# touch /etc/vsftpd/vconf/vsuser2
# mkdir -p /home/vsftp/vsuser2/http/mydic
</code></pre><h3 id="2-修改权限"><a href="#2-修改权限" class="headerlink" title="2.修改权限"></a>2.修改权限</h3><pre><code># chmod -R 755 /home/vsftp/vsuser2/http
# chmod -R 777 /home/vsftp/vsuser2/http/mydic
</code></pre><h3 id="3-添加虚拟用户名单内容-奇数行是账号，偶数行是密码"><a href="#3-添加虚拟用户名单内容-奇数行是账号，偶数行是密码" class="headerlink" title="3.添加虚拟用户名单内容(奇数行是账号，偶数行是密码)"></a>3.添加虚拟用户名单内容(奇数行是账号，偶数行是密码)</h3><pre><code># vi /etc/vsftpd/virtusers
vsuser2
123456  #保存退出
</code></pre><h3 id="4-编辑虚拟用户配置文件"><a href="#4-编辑虚拟用户配置文件" class="headerlink" title="4.编辑虚拟用户配置文件"></a>4.编辑虚拟用户配置文件</h3><pre><code># vi /etc/vsftpd/vconf/vsuser2

local_root=/home/vsftp/vsuser2/http/　　#设置FTP账号根目录
</code></pre><h3 id="5-生成虚拟用户数据文件"><a href="#5-生成虚拟用户数据文件" class="headerlink" title="5.生成虚拟用户数据文件"></a>5.生成虚拟用户数据文件</h3><pre><code># db_load -T -t hash -f /etc/vsftpd/virtusers /etc/vsftpd/virtusers.db
# chmod 600 /etc/vsftpd/virtusers.db
</code></pre><h3 id="6-重启服务器"><a href="#6-重启服务器" class="headerlink" title="6.重启服务器"></a>6.重启服务器</h3><pre><code># systemctl restart vsftpd.service
</code></pre><h1 id="0x16-总结"><a href="#0x16-总结" class="headerlink" title="0x16 总结"></a>0x16 总结</h1><p>应该专门创建一个根目录来作为FTP的文件目录，/home目录作为敏感目录，不应该在这个目录下建立和FTP有关的文件。在进入FTP后，传输文件可能会丢一些东西，因为是传的文本，所以先输入bin命令回车，这时候传的文件就会以二进制的方式传输，就不会找出文件数据丢失的情况了。</p>
<h3 id="未经本人允许，禁止转载"><a href="#未经本人允许，禁止转载" class="headerlink" title="未经本人允许，禁止转载"></a>未经本人允许，禁止转载</h3>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ftp的搭建/" rel="tag"><i class="fa fa-tag"></i> ftp的搭建</a>
          
            <a href="/tags/建立虚拟用户/" rel="tag"><i class="fa fa-tag"></i> 建立虚拟用户</a>
          
            <a href="/tags/ftp常用命令/" rel="tag"><i class="fa fa-tag"></i> ftp常用命令</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/20/deploy-net/" rel="next" title="CentOS7网络配置问题">
                <i class="fa fa-chevron-left"></i> CentOS7网络配置问题
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/25/kvm-deploy/" rel="prev" title="CentOS7下部署KVM以及virsh常用命令">
                CentOS7下部署KVM以及virsh常用命令 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Peithon</p>
              <p class="site-description motion-element" itemprop="description">一些笔记和学习记录</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#FTP用户登陆一般分为三种类型"><span class="nav-number">1.</span> <span class="nav-text">FTP用户登陆一般分为三种类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#匿名用户"><span class="nav-number">1.1.</span> <span class="nav-text">匿名用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#本地用户"><span class="nav-number">1.2.</span> <span class="nav-text">本地用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#虚拟用户"><span class="nav-number">1.3.</span> <span class="nav-text">虚拟用户</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x00-FTP的安装"><span class="nav-number"></span> <span class="nav-text">0x00 FTP的安装</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01-新建系统用户"><span class="nav-number"></span> <span class="nav-text">0x01 新建系统用户</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02-设置vsftpd服务器的配置文件"><span class="nav-number"></span> <span class="nav-text">0x02 设置vsftpd服务器的配置文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x03-虚拟用户个人vsftp服务器的配置文件"><span class="nav-number"></span> <span class="nav-text">0x03 虚拟用户个人vsftp服务器的配置文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x04-虚拟用户名单文件"><span class="nav-number"></span> <span class="nav-text">0x04 虚拟用户名单文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x05-设置权限"><span class="nav-number"></span> <span class="nav-text">0x05 设置权限</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x06-生成虚拟用户数据文件"><span class="nav-number"></span> <span class="nav-text">0x06 生成虚拟用户数据文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x07-设定PAM验证文件，并指定对虚拟用户数据库文件进行读取"><span class="nav-number"></span> <span class="nav-text">0x07 设定PAM验证文件，并指定对虚拟用户数据库文件进行读取</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x08-防火墙配置文件"><span class="nav-number"></span> <span class="nav-text">0x08 防火墙配置文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x09-关闭SELINUX"><span class="nav-number"></span> <span class="nav-text">0x09 关闭SELINUX</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0X10-重启vsftpd服务器"><span class="nav-number"></span> <span class="nav-text">0X10 重启vsftpd服务器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x11-安装ftp客户端"><span class="nav-number"></span> <span class="nav-text">0x11 安装ftp客户端</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x12-FTP数字代码的意义"><span class="nav-number"></span> <span class="nav-text">0x12 FTP数字代码的意义</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x13-测试ftp"><span class="nav-number"></span> <span class="nav-text">0x13 测试ftp</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#本地测试报500错误"><span class="nav-number">1.</span> <span class="nav-text">本地测试报500错误</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#解决方法"><span class="nav-number">1.1.</span> <span class="nav-text">解决方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他主机无法连接ftp"><span class="nav-number">2.</span> <span class="nav-text">其他主机无法连接ftp</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#解决方法-1"><span class="nav-number">2.1.</span> <span class="nav-text">解决方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x14-ftp常用命令"><span class="nav-number"></span> <span class="nav-text">0x14 ftp常用命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x15-添加只有下载权限的新虚拟用户"><span class="nav-number"></span> <span class="nav-text">0x15 添加只有下载权限的新虚拟用户</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-创建虚拟用户的配置文件"><span class="nav-number">0.1.</span> <span class="nav-text">1.创建虚拟用户的配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-修改权限"><span class="nav-number">0.2.</span> <span class="nav-text">2.修改权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-添加虚拟用户名单内容-奇数行是账号，偶数行是密码"><span class="nav-number">0.3.</span> <span class="nav-text">3.添加虚拟用户名单内容(奇数行是账号，偶数行是密码)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-编辑虚拟用户配置文件"><span class="nav-number">0.4.</span> <span class="nav-text">4.编辑虚拟用户配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-生成虚拟用户数据文件"><span class="nav-number">0.5.</span> <span class="nav-text">5.生成虚拟用户数据文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-重启服务器"><span class="nav-number">0.6.</span> <span class="nav-text">6.重启服务器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x16-总结"><span class="nav-number"></span> <span class="nav-text">0x16 总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#未经本人允许，禁止转载"><span class="nav-number">0.1.</span> <span class="nav-text">未经本人允许，禁止转载</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Peithon</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">15.8k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>








        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("YV6LWh5W8UQ3bQKoo628fNVK-gzGzoHsz", "SnDWsQ8dkIu3YguxR8PB7ok5");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
